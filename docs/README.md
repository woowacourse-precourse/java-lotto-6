# 미션 - 로또 💰

--- 
## ✏️ 요구사항 

로또 게임 기능을 구현한다. 로또 게임은 아래와 같은 규칙으로 진행된다.

- 로또 구입 금액을 입력하면 구입 금액에 해당하는 만큼 로또를 발행한다.  
  (로또 1장의 가격은 1,000원이다.)  
- 당첨 번호와 보너스 번호를 입력받는다.
- 사용자가 구매한 로또 번호와 당첨 번호를 비교하여 당첨 내역 및 수익률을 출력하고 로또 게임을 종료한다.

이를 정리해보면 다음과 같다.

<img src="flowchart.png" width="800" height="500"/>

---

## 🚀 기능 목록


### 핵심 로직

| 역할          | 기능(책임)                                    | 비고                                                                                                                                                                             |
|:------------|:------------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 로또          | 6개의 숫자를 가진다<br/>입력받은 숫자를 로또가 가지고 있는지 확인한다 | 숫자는 1~45 사이의 **랜덤** 값이며, 각 숫자는 중복되지 않는다                                                                                                                                        |
| 당첨 로또       | 로또(6개의 당첨 숫자)와 보너스 숫자 1개를 가진다             | 1~45 사이의 값이며 숫자와 보너스 숫자는 모두 중복되지 않는다                                                                                                                                           |
| 로또 결과       | 로또의 당첨 결과와 이에 해당하는 상금을 가진다                | 열거형 타입<br/>1등: 6개 번호 일치 / 2,000,000,000원 <br/>2등: 5개 번호 + 보너스 번호 일치 / 30,000,000원<br/> 3등: 5개 번호 일치 / 1,500,000원 <br/>4등: 4개 번호 일치 / 50,000원 <br/>5등: 3개 번호 일치 / 5,000원<br/> 이외는 낙첨 |
| 로또 발행       | 입력받은 금액만큼 로또를 발행한다                        | 로또 1장의 가격은 1,000원이다<br/>구입금액/1,000 만큼 로또를 발행한다                                                                                                                                 |
| 로또 결과 확인    | 로또와 당첨 번호를 비교해 결과를 반환한다                   | 일치하는 개수와 보너스 숫자 일치 여부를 반환한다                                                                                                                                                    |                                                                                                                                                                         |

### UI 로직

| 구분 | 책임                  | 비고                                                          |
|:---|:--------------------|:------------------------------------------------------------|
| 입력 | 로또 구입 금액을 입력받는다     | 금액은 1,000원 단위이다                                             |
| 입력 | 당첨 번호를 입력받는다        | 1~45 사이의 숫자 6개를 입력받는다<br/> 숫자는 쉼표(,)로 구분된다                  |
| 입력 | 보너스 번호를 입력받는다       | 1~45 사이의 숫자 1개를 입력받는다                                       |
| 출력 | 발행한 로또 수량과 번호를 출력한다 | 번호는 오름차순으로 정렬해 출력한다                                         |
| 출력 | 당첨 내역과 수익률을 출력한다.   | 수익률의 경우 소수점 둘째 자리에서 반올림한다                                   |

입력 부분에서 해당 조건에 부합하지 않는 잘못된 값을 입력한 경우, IllegalArgumentException이 발생한다.
에러 메시지와 함께 에러 발생 후, 해당 부분부터 다시 입력받는다.

---

## ✅ 테스트 

주어진 요구사항에 따라 UI 로직을 제외한 핵심 로직에만 테스트를 구현했다.

### 로또

`로또 번호는 1~45 사이의 중복되지 않는 6개의 숫자여야 한다. `

이는 세부적으로 나누면 다음의 세 가지 경우이다.

- 로또 번호는 **6개**여야 한다.
- 로또 번호는 **중복**되지 않아야 한다.
- 로또 번호는 **1~45** 사이의 값이어야 한다.

세 가지 경우에는 예외가 발생해야 하므로 다음의 테스트를 진행한다.

| 테스트 내용                    | 입력 예시               | 통과 여부 |
|:--------------------------|:--------------------|:------|
| 로또 번호가 6개가 아니면 예외 발생      | 1, 2, 3, 4, 5, 6, 7 | ✔️ |
| 로또 번호가 중복이면 예외 발생         | 1, 2, 3, 4, 5, 5    | ✔️ |
| 로또 번호가 1~45 사이에 없으면 예외 발생 | 1, 2, 3, 4, 5, 46   | ✔️ |

---

### 당첨 로또

당첨 로또는 6개의 당첨 번호와 1개의 보너스 번호로 이루어져 있다.  
6개의 당첨 번호의 경우 위의 로또 번호와 마찬가지로 세 가지 조건을 모두 만족해야 한다.

| 테스트 내용                    | 입력 예시                     | 통과 여부 |
|:--------------------------|:--------------------------|:------|
| 당첨 번호가 6개가 아니면 예외 발생      | (1, 2, 3, 4, 5, 6, 7), 45 | ✔️ |
| 당첨 번호가 중복이면 예외 발생         | (1, 2, 3, 4, 5, 5), 45    | ✔️ |
| 당첨 번호가 1~45 사이에 없으면 예외 발생 | (1, 2, 3, 4, 5, 46), 45   | ✔️ |

보너스 번호의 경우 두 가지 조건을 만족해야 한다.

- 보너스 번호는 1~45의 숫자여야 한다.
- 당첨 번호와 중복되지 않아야 한다. 

| 테스트 내용                     | 입력 예시                  | 통과 여부 |
|:---------------------------|:-----------------------|:------|
| 보너스 번호가 1~45 사이에 없으면 예외 발생 | (1, 2, 3, 4, 5, 6), 46 | ✔️ |
| 보너스 번호가 당첨 번호와 중복이면 예외 발생  | (1, 2, 3, 4, 5, 6), 6  | ✔️ |

---

### 로또 결과

로또 결과는 맞춘 개수에 대한 변수와 상금 변수로 구성되어 있다.

| 테스트 내용                          | 입력 예시                  | 결과 예시         | 통과 여부 |
|:--------------------------------|:-----------------------|:--------------|:-------|
| 맞힌 개수와 보너스 번호 일치 여부에 맞는 결과를 가진다 | (5, true)              | FIRST_PRIZE   | ✔️  |
| 결과에 맞는 상금을 반환한다 | FIRST_PRIZE.getPrize() | 2_000_000_000 | ✔️           |

---

### 로또 발행

로또 발행의 경우, 구입 금액에 대해 검증한 뒤 해당 금액만큼 로또를 발행한다.  
로또 1장의 가격은 1,000원 이므로 구입 금액에 대한 조건은 다음의 두가지이다.

- 구입 금액은 1,000원 이상이어야 한다.
- 구입 금액은 1,000원 단위여야 한다. (1,000으로 나누어 떨어져야 한다.)

| 테스트 내용                        | 입력 예시 | 통과 여부 |
|:------------------------------|:------|:------|
| 구입 금액이 1,000원보다 적으면 예외 발생     | 900   | ✔️    |
| 구입 금액이 1,000원 단위가 아니면 예외 발생   | 1800  | ✔️    |

로또 생성에 대한 테스트는 다음의 두 가지로 진행했다.

| 테스트 내용               | 테스트 방식                   | 통과 여부        |
|:---------------------|:-------------------------|:-------------|
| 로또를 생성한다             | 생성된 값의 클래스와 Lotto 클래스 비교 |  ✔️          |
| 구입금액/1000만큼 로또를 생성한다 | size()와 구입금액/1000 값 비교   | ✔️           |

---

### 로또 결과 확인

로또 결과 확인의 경우 개별 로또와 당첨 번호를 비교해 결과를 반환하는 check 메서드와 로또 리스트의 결과를 리스트로 반환하는 getResults 메서드가 있다.

getResults 메서드가 check() 메서드로 작동하므로, check 메서드에 대한 별도의 테스트는 진행하지 않았다.

| 테스트 내용                          | 입력 예시                                                                                                 | 결과 예시         | 통과 여부 |
|:--------------------------------|:------------------------------------------------------------------------------------------------------|:--------------|:-------|
| 로또 리스트와 당첨 번호를 비교해 결과 리스트를 반환한다 | 로또1 (1,2,3,4,5,6)<br/>로또2 (1,2,3,4,5,7)<br/>로또3 (11, 22, 33, 44, 5, 45)<br/> (당첨번호, 보너스 번호): ((1,2,3,4,5,6), 7) | FIRST_PRIZE, SECOND_PRIZE, NO_PRIZE | ✔️           |

---

## 🤔 고려 사항

3주차 과제에서 가장 크게 고민했던 사항들은 작주에 비해 추가된 요구사항인 로직 분리와 Java Enum 활용, 그리고 별도의 예외 처리 부분이었다.

### Java Enum 활용
로또 당첨 결과(1~5등, 낙첨)를 열거형을 이용해 표현했다.   
열거형에 멤버나 메서드를 추가해 사용해 본 경험이 없었기 때문에 이러한 부분에서 시행착오가 있었다.

1. `FIRST_PRIZE(6,false) {int prize() {return 2_000_000_000;}}` ➔ `FIRST_PRIZE(6, 2_000_000_000)`
    
   > 초반에는 로또 결과가 맞춘 개수와 보너스 여부를 멤버로 가지고, 해당 결과에 맞는 상금을 반환하는 추상 메서드를 구현하는 방식으로 설계했다.
   > <br> 그러나 **당첨 결과가 보너스 번호 일치 여부를 가지고 있어야 하는가?** 를 생각해봤을 때, 2등을 제외한 다른 결과들은 보너스볼 일치 여부와는 무관하다. 따라서 멤버에서 **보너스볼과 관련된 부분은 삭제**했다. 
   > <br> 상금을 반환하는 prize 메서드 또한, 상금마다 별도의 로직이 존재하는 것이 아니라 상금에 따른 특정 값을 가지고 있을 뿐이므로 **멤버에 추가**해주는 식으로 수정했다.    
      
   
2. `List<Result> prize = {FIFTH_PRIZE , ... , FIRST_PRIZE};`  ➔ `Result.values()`

   >  로또의 당첨 결과를 출력하는 OutputManager에서 1~5등의 결과를 등수가 낮은 순서대로 출력해야 했다. Result에는 낙첨의 경우도 포함되어 있어 낙첨의 경우를 제거하는 방식도 고려대상에 있었으나 **당첨되지 않은 상태 또한 결과가 가지고 있어야 할 책임**이라고 생각했다.
   > <br>초기에는 Enum 활용에 미숙해 별도의 Result 리스트를 생성해 커스텀해주었다. 
   > <br>그러나 이러한 방식은 Enum을 활용하는 방식이 아니라고 판단해 Enum의 선언 순서를 바꾸고 **values()를 활용**하는 방식으로 코드를 수정했다.



### 로직 분리

핵심 비즈니스 로직과 입출력을 관리하는 UI 로직을 분리하는 것 자체는 개념적으로 어렵지 않았다.  
핵심 로직 또한 요구사항을 책임과 역할로 분리하여 생각하려고 노력했다. 관심사별로 분리해 독립적으로 설계하니 변경에 유연하게 대처할 수 있어 보다 수월하게 리팩토링을 진행할 수 있었다.

1. 로또(Lotto)의 역할과 당첨 로또(WinningLotto) 
   > 로또와 당첨 로또는 6개의 번호를 의미하는 List<Integer> 타입의 numbers를 멤버로 가지고 있다. 
   > <br>둘다 numbers 자체에 대한 검증이나 접근 방식이 같기 때문에 로또 공과 관련해 **또다른 구현체를 생성해야 하는가**에 대한 고민이 있었으나, 로또 공이라는 새로운 구현체를 만드는 것은 현재의 요구사항 수준에서는 불필요한 과정이라고 생각해 생략했다.
   > <br><br>대신, 기존의 **로또와 당첨 번호가 각각의 numbers를 가지고 있으며 검증도 따로 진행하던 방식** 에서 **당첨 로또가 로또를 멤버로 가지도록 변경**했다. 번호에 대해 검증받는 부분도 자연스럽게 로또 객체를 생성하며 검증할 수 있게 되었다.  
   > 보너스 볼이 당첨 번호와 중복되는지 여부를 확인하는 과정 역시 로또에서 **해당 번호가 로또 내에 존재하는가?** 에 대한 책임을 수행하는 것이 적절하다고 판단해 로또에 **hasNumber 메서드를 추가** 하고 이를 이용해 보너스 번호를 검증하는 방식으로 설계를 수정했다.

2. 검증과 예외 처리
   > 입출력과 핵심 로직을 분리해 설계하면서 **입력과 핵심 로직 구현체는 각각 어디까지 검증해야 하는가**에 대한 고민이 있었다. 초반 설계 시에는 이에 대한 명확한 해답이 내려지지 않아 양쪽에서 중복되는 검증을 수행했다.
   > <br><br>예를 들어 입력에서 당첨 번호 6자리를 입력받을 때 6개의 숫자가 중복없이 존재하는지에 대한 검증을 수행하고, 검증된 숫자들을 바탕으로 로또 객체를 생성할 때 한번 더 같은 검증을 수행하는 식이었다.
   > <br><br>**입력에서의 책임과 구현체에서의 책임을 분리**하려는 노력에서 이에 대한 해답을 얻을 수 있었다.   
   > <br>**입력**은 입력받은 String 타입의 입력 자체에 대해서만 주어진 조건에 부합하는지 검증하고 이를 원하는 형태로 변환해 반환한다. **구현체**는 객체를 생성하고 로직을 수행하기 위한 검증을 수행한다.
   > <br>이러한 방식으로 책임을 명확히 분리하니, 위와 같은 예시 또한 다음과 같이 검증에 대한 책임을 분담할 수 있었다.
   > <br><br>입력에서는 6개의 숫자와 구분자로만 이루어진 입력인지를 검증한 뒤 이를 숫자 리스트로 반환하고, 구현체에서는 숫자의 중복 여부나 범위에 대해 검증한다. 
   
### 예외 처리

이번 과제에서는 예외의 유형별로 별도의 에러 메시지를 출력하는 요구사항이 추가되었다.  
위의 로직 분리에서 검증과 예외 처리와 일맥상 통하는 내용이며 다음과 같은 예외 유형을 정의하고 처리했다.

IllegalArgumentException 에 관련된 예외 처리만을 수행했다.

#### 입력(InputManager)
| 검증 메서드           | 유형                                   | 에러 메시지 | 예시          |
|:-----------------|:-------------------------------------|:-------|:------------|
| validatedNumbers | 6개 숫자 입력 시, 숫자나 구분자(,) 이외의 값을 입력한 경우 | [ERROR] 숫자와 구분자(,)만 입력 가능합니다.       | 일,2,3,4,5,@ |
| validatedNumbers | 6개 숫자 입력 시, 구분자(,) 없이 값을 입력한 경우      | [ERROR] 숫자 6개를 구분자(,)로 구분해 입력하세요.       | 123456      |
| validatedNumber  | 1개 숫자 입력 시, 숫자 이외의 값을 입력한 경우         | [ERROR] 숫자만 입력하세요.       | ₩           |

#### 구현체(Lotto, WinningLotto, LottoGenerator)
| 클래스(검증 메서드)                 | 유형                               | 에러 메시지 | 예시                                   |
|:----------------------------|:---------------------------------|:-------|:-------------------------------------|
| Lotto(validate)             | 중복 제거 후 숫자 개수가 6개를 만족하지 않는 경우    | [ERROR] 6개의 숫자를 중복없이 입력하세요.       | 1,2,3,4,5,5 <br/> 1,2,3,4,5,6,7      |
| Lotto(validateNumbers)      | 숫자 범위(1~45) 내에 존재하지 않는 값이 있는 경우  |[ERROR] 1~45 사이의 숫자를 입력하세요.| 1,2,3,4,5,46                         |
| WinningLotto(validateBonus) | 보너스 값이 숫자 범위(1~45) 내에 존재하지 않는 경우 |[ERROR] 1~45 사이의 숫자를 입력하세요.| 46                                   |
| WinningLotto(validateBonus) | 숫자 범위(1~45) 내에 존재하지 않는 값이 있는 경우  |[ERROR] 당첨 번호와 보너스 번호가 중복됩니다.| 당첨번호가 1,2,3,4,5,6 일 때, 보너스 번호가 6인 경 |
| LottoGenerator(from)        | 구입 금액이 1,000보다 작은 경우             |[ERROR] 로또의 최소 구매 가능 금액은 1,000원입니다.| 900                                  |
| LottoGenerator(from)        | 구입 금액이 1,000원 단위가 아닌 경우           |[ERROR] 로또는 1,000원 단위로만 구매 가능합니다.| 900                                  |

