# 우아한테크코스 프리코스 3주차
# 미션 - 로또

---

## 기능 요구 사항
- [x] 로또 구입 금액을 입력 받는다. 
  - 구입 금액은 1,000원 단위로 입력받으며, 1000원으로 나누어 떨어지지 않는 경우 예외 처리한다.

- [x] 로또 1장의 가격은 1,000원이며, 입력한 구입 금액만큼의 로또를 발행한다.
  - 로또는 중복되지 않는 1부터 45까지의 6개의 숫자로 구성되어 있다.
  - 발행 후, 콘솔에 발행된 로또를 차례대로 출력한다.

- [x] 당첨 번호를 입력 받는다. 번호는 쉼표를 기준으로 구분한다.

- [x] 보너스 번호를 입력 받는다. 

- [x] 당첨 여부를 확인하고, 각 로또에 대한 당첨 내역를 출력한다.
  
        3개 일치 (5,000원) - 1개
        4개 일치 (50,000원) - 0개
        5개 일치 (1,500,000원) - 0개
        5개 일치, 보너스 볼 일치 (30,000,000원) - 0개
        6개 일치 (2,000,000,000원) - 0개

- [x] 수익률을 출력한다. 수익률은, 소수점 둘째 자리에서 반올림한다.

- [x] 입력한 값이 잘못된 경우, [ERROR]로 시작하는 예외 메시지를 출력하며, 해당 부분부터 다시 입력을 받는다.

--- 

## 기능 구현 사항 - domain
- [x] domain에서 쓰이는 상수들을 별도로 정의한 DomainConstant 클래스


- [x] 돈과 관련된 연산을 수행하는 Money 클래스
  - 프로그램상에서 사용되는 '금액'과 관련된 연산들을 정의하였습니다.
  - 필드는 long타입을 이용합니다.


- [x] 한 장의 로또에 대한 정보를 저장하는 Lotto 클래스
  - 입력된 숫자에 대한 예외를 검증합니다. 주어진 예외 검증에 중복 번호 검증, 숫자 범위 검증을 추가하였습니다.
    - 예외 메시지는 내부에 정의한 LottoErrorMessage라는 enum에 별도로 저장하였습니다.
  - 당첨 번호와의 비교를 위해, 한 개의 숫자를 포함하고 있는지 여부를 반환하는 기능을 정의하였습니다.
    - 모든 당첨 번호에 대해 이 메서드를 호출합니다.
  - toString을 재정의하여, 로또 번호가 1,2,3,4,5,6인 경우 [1, 2, 3, 4, 5, 6]과 같이 출력하도록 설정하였습니다.


- [x] 당첨 번호에 대한 정보를 저장하는 WinningLotto 클래스
  - 필드로 Lotto 객체와 int 값인 보너스 번호를 가집니다.
  - 한 장의 Lotto를 받아서, 비교한 뒤 LottoPrizes의 상수로 반환하는 기능이 정의되어 있습니다.
    - 당첨되지 않은 경우 null을 반환합니다.
  

- [x] 로또의 '숫자'를 만드는 LottoNumberGenerator 클래스
  - 주어진 Randoms 라이브러리를 이용하여, 1부터 45까지의 6개의 숫자 리스트를 만들고, 이를 정렬하여 반환합니다.
  - 입력이 "1,2,3,4,5,6"과 같은 문자열로 주어진 경우, 이를 숫자 리스트로 바꿔서 반환합니다.


- [x] 로또를 만드는 LottoGenerator 클래스
  - 테스트를 위해, LottoNumberGenerator를 주입받을 수 있도록 생성자를 설정하였습니다.
    - 실제로는, 로또 생성은 주어진 라이브러리를 사용하며 단순 연산을 이용하므로 생성과 관련된 테스트는 진행하지 않았습니다.
  
  - 입력된 문자열 형태의 당첨 번호와 long 타입의 보너스 번호를 이용하여, WinningLotto 객체를 생성합니다.
    - 당첨 번호와 보너스 번호 각각에 대해 예외를 검증합니다.
  
  - 입력된 금액을 이용하여, 금액 만큼의 로또 리스트 생성합니다.
    - 금액에 대해 예외를 검증합니다.
    - 한 개의 로또를 만드는 기능을 분리하고, 이를 여러번 호출하여 금액을 1000으로 나눈 갯수만큼의 로또를 생성합니다.
  

- [x] 당첨 정보가 저장된 LottoPrizes enum
  - 각 상수는 당첨금 정보를 저장하고 있습니다.
  - 각 상수가 몇번 당첨되었는지를 저장하기 위한 EnumMap을 초기화하여 제공합니다.


- [x] 로또 당첨 결과를 처리하는 LottoResult 클래스
  - 각 당첨 경우에 대한 갯수를 저장하는 Map을 이용하여, 총 당첨금을 얻어내는 기능이 정의되어 있습니다.
  - 각 당첨 횟수를 List<Long>으로 제공하고, 이를 OutputView에서 이용하여 통계를 출력합니다.


- [x] 유저의 모든 로또를 저장하는 UserLottos 클래스
  - Lotto 클래스에서 재정의한 toString을 이용하여, 모든 로또를 조건의 형식대로 반환합니다.
  - 유저의 모든 로또와 당첨 로또 번호를 비교하고 결과를 LottoResult 객체로 반환합니다.

---

## 기능 구현 사항 - View
- [x] 입력을 받아들이는 기능을 추상화한 InputViewable 인터페이스
  - 공통적으로 쓰이는 메서드는 default 메서드로 지정하여, 각 구현에서 사용합니다.
  - 각 구현에선, validate라는 메서드만 재정의하여, 각각의 검증 방법을 다르게 구현합니다.


- [x] 구입 금액과 관련된 입력을 받아들이는 PurchaseAmountInputView 클래스
  - InputViewable과, Supplier<Long>을 구현하였습니다.
  - 구입 금액과 관련된 예외 검증 메서드를 분리하였습니다.


- [x] 당첨 번호와 관련된 입력을 받아들이는 WinningNumberInputView 클래스
  - InputViewable과, Supplier<String>을 구현하였습니다.
  - 당첨 번호와 관련된 예외 검증 메서드를 분리하였습니다.


- [x] 보너스 번호와 관련된 입력을 받아들이는 BonusNumberInputView 클래스
  - InputViewable과, Supplier<Integer>을 구현하였습니다.
  - 보너스 번호와 관련된 예외 검증 메서드를 분리하였습니다.


- [x] 출력을 전담하는 OutputView 클래스
  - domain에서 유저의 로또 정보, 각 당첨 횟수, 수익금을 원시값 형태로 받아, 조건의 형식대로 출력합니다.
  

- [x] View에서 쓰이는 상수들이 정의된 ViewConstant 클래스
  - 내부의 InputViewConstant 클래스에는 InputView에서 사용되는 상수와 예외 메시지 enum이 저장되어 있습니다.
  - 내부의 OutputViewConstant 클래스에는 OutputView에서 사용되는 상수가 저장되어 있습니다.
  
---
  
## 기능 구현 사항 - Controller
- [x] View를 이용하여, 입출력을 관리하는 LottoViewController 클래스
  - 입력에 대한 예외가 발생할 경우, 예외 메시지를 출력하고 입력을 반복해서 받도록 설정하였습니다.
    - 제네릭과 Supplier를 이용하여, 입력을 반복하여 받는 코드의 중복을 제거하였습니다.
  - 내부의 메서드를 모두 default로 지정하여, controller 패키지 내에서만 사용하도록 설정하였습니다.


- [x] domain과 LottoViewController를 이용하여 게임을 관리하는 LottoController 클래스
  - 게임 진행과 관련된 로직들이 포함되어 있습니다.

---

## 예외 처리 사항
- 코드 중복을 감안하더라도, domain과 view의 분리를 위해 예외 검증은 domain, view에서 각각 진행합니다.
  - view에서는 문자열 형태를 주로 검증하고, domain에서는 숫자, 리스트로 파싱된 값을 위주로 예외를 검증합니다. 


- [x] InputViewable의 구현 클래스에서의 검증
  - 하나의 숫자에 대해 검증하는 메서드와, 숫자로만 이루어졌는지를 검증하는 메서드는 default로 선언하고, 당첨 번호와 보너스 번호에서 이를 이용합니다.
  
  - PurchaseAmountInputView 에서의 검증

        (1) 입력이 비어있는지 확인
        (2) 입력에 숫자 이외의 문자가 들어있는지 확인
        (3) 금액이 1000원 미만인지 확인
        (4) 금액이 1000원 단위인지 확인

  - WinningNumberInputView에서의 검증
      
        (1) 입력이 비어있는지 확인
        (2) 입력의 형식이 올바른지 확인 -> 구분자로 쉼표를 사용했는지, 숫자 이외의 문자가 있는지..
        (3) 6개의 숫자로 이루어져 있는지
        (4) 중복된 숫자가 존재하는지
        (5) (1)~(3)을 모두 통과하면, 각 번호가 숫자만으로 이루어졌는지, 1부터 45까지의 범위로 이루어졌는지 확인

  - BonusNumberInputView에서의 검증
  
        (1) 입력이 비어있는지 확인
        (2) 입력이 숫자인지를 확인
        (3) 범위가 1부터 45까지인지를 확인
        (4) 보너스 번호가 당첨 번호와 중복되는지를 확인
  
- [x] LottoGenerator에서의 검증


      - 로또 구입 금액에 대한 검증
        - InputView에서는 문자열로 주어진 금액을 검증했다면, LottoGenerator에선 Money 객체로 주어진 금액을 검증합니다.
        
    
      - 당첨 번호에 대한 검증
        - InputView에서의 검증과 동일하게 진행합니다.
      
    
      - 보너스 번호에 대한 검증
        - InputView에서는 문자열로 주어진 보너스 번호를 검증했다면, LottoGenerator에선 정수로 주어진 보너스 번호를 검증합니다.
  

- [x] Lotto에서의 검증
  

      - 숫자의 갯수가 6개인지에 대한 검증
    
      - 중복된 번호가 존재하는지에 대한 검증
  
      - 숫자가 모두 1부터 45까지의 숫자인지에 대한 검증
  

---

## 테스트 구현 사항
- 상수 클래스에 대해선 테스트를 진행하지 않았습니다.


- View에 대한 테스트는 진행하지 않음. 입력값 예외 발생은 LottoController에서 한번에 검증합니다.
  - 마찬가지로, View만 이용하는 LottoViewController 클래스에 대한 테스트도 LottoController를 통해 수행합니다.


- [x] 주어진 ApplicationTest : 통과


- [x] Money 클래스에 대한 테스트
  - 정의된 모든 연산에 대해 올바른 결과를 반환하는지 테스트합니다.
  - 나눗셈 연산인 getPercentageOf는, 오차 범위를 0.01로 설정하여 테스트합니다.
  

- [x] LottoController 클래스에 대한 테스트
  - 주어진 라이브러리의 NSTest를 상속한 뒤, 입력을 반복하여 받는지에 대한 부분에 대해서만 주어진 테스트 코드를 활용하였습니다.
  - 금액, 당첨 번호, 보너스 번호 각각에 대한 모든 예외를 발생시키고, 입력을 반복하여 받는지 확인합니다.
  - 모든 입력이 정상일 때, 게임을 정확하게 실행하고 종료하는지 확인합니다.


- [x] LottoGenerator 클래스에 대한 테스트
  - 금액, 당첨 번호, 보너스 번호 각각에 대한 모든 예외를 검증합니다.
  - 정상적인 값을 넣었을 때에 정확한 로또를 반환하는지에 대한 테스트를 감안하여 프로덕션 코드를 구현하였으나, 이 부분은 의미가 없다고 생각하여 진행하지 않았습니다.
      - 예외 검증만 통과한다면, 단순한 연산이기 때문입니다.


- [x] LottoNumberGenerator 클래스에 대한 테스트
  - 당첨 번호를 순서대로 입력하지 않았을 때에도 정렬된 번호를 반환하는지를 테스트합니다.
  

- [x] LottoResult 클래스에 대한 테스트
  - 5개의 당첨 결과 중 1개만 당첨되는 모든 경우와 5개의 결과 모두 당첨된 경우를 이용하여 당첨금을 정확하게 반환하는지 테스트합니다.


- [x] Lotto 클래스에 대한 테스트
  - 기본적으로 주어진 테스트 : 통과
  - 추가적으로, 1부터 45까지의 숫자인지를 검증하는 테스트를 추가하였습니다.


- [x] UserLottos 클래스에 대한 테스트
  - 유저의 로또 정보를 정하고, 이를 정확히 요구사항의 출력대로 반환하는지 확인합니다.
  - 당첨 번호를 정하고, 당첨 번호와 비교하여 정확한 LottoResult 객체를 반환하는지 확인합니다.


- [x] WinningLotto 클래스에 대한 테스트
  - 한 개의 로또의 당첨 여부를 모든 가능한 경우에 대해 확인하고, 정확한 결과를 반환하는지 확인합니다.

---

## 출력 예시 - 예외가 발생했을 때의 출력 예시

    구입금액을 입력해 주세요.
    
    [ERROR] 입력이 존재하지 않습니다.
    
    구입금액을 입력해 주세요.
    abc
    [ERROR] 숫자 이외의 문자는 포함될 수 없습니다.
    
    구입금액을 입력해 주세요.
    950
    [ERROR] 최소 1000원의 금액을 입력해야 합니다.
    
    구입금액을 입력해 주세요.
    5929
    [ERROR] 금액은 1000원 단위로 입력해야 합니다.
    
    구입금액을 입력해 주세요.
    5000
    
    5개를 구매했습니다.
    [5, 14, 21, 29, 39, 42]
    [5, 12, 17, 28, 30, 33]
    [1, 5, 11, 30, 34, 37]
    [11, 15, 25, 31, 38, 42]
    [14, 17, 20, 27, 38, 45]
    
    당첨 번호를 입력해 주세요.
    
    [ERROR] 입력이 존재하지 않습니다.
    
    당첨 번호를 입력해 주세요.
    1:2:3:4:5:6
    [ERROR] 입력 형식이 올바르지 않습니다.
    
    당첨 번호를 입력해 주세요.
    1,2,3,4,5,6,7
    [ERROR] 당첨 번호는 6개의 숫자로 이루어져야 합니다.
    
    당첨 번호를 입력해 주세요.
    1,2,3,4,5,100
    [ERROR] 숫자 범위는 1부터 45까지 가능합니다.
    
    당첨 번호를 입력해 주세요.
    1,2,3,4,5,6
    
    보너스 번호를 입력해 주세요.
    
    [ERROR] 입력이 존재하지 않습니다.
    
    보너스 번호를 입력해 주세요.
    -a
    [ERROR] 값은 숫자만 가능합니다.
    
    보너스 번호를 입력해 주세요.
    -1
    [ERROR] 숫자 범위는 1부터 45까지 가능합니다.
    
    보너스 번호를 입력해 주세요.
    47
    [ERROR] 숫자 범위는 1부터 45까지 가능합니다.
    
    보너스 번호를 입력해 주세요.
    7
    
    당첨 통계
    ---
    3개 일치 (5,000원) - 0개
    4개 일치 (50,000원) - 0개
    5개 일치 (1,500,000원) - 0개
    5개 일치, 보너스 볼 일치 (30,000,000원) - 0개
    6개 일치 (2,000,000,000원) - 0개
    총 수익률은 0.0%입니다.